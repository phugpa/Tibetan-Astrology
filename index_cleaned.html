from pathlib import Path
import base64

# Try to load the background image and embed as base64
img_path = Path("/mnt/data/250px-839-hd.jpg")
if img_path.exists():
    b64 = base64.b64encode(img_path.read_bytes()).decode("ascii")
    bg_data_uri = f"data:image/jpeg;base64,{b64}"
else:
    # Solid fallback if image not present (the site will still work)
    bg_data_uri = ""

html = f"""<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tibetan Astrology</title>
  <style>
    :root {{ --bg:#0b0f14; --card:#101720; --muted:#9fb0c3; --text:#e8eef5; --accent:#69b3ff; }}
    *{{ box-sizing:border-box; }}
    body{{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans'; background:#111418; color:var(--text); }}
    body::before{{
      content:"";
      position:fixed; inset:0; z-index:-1;
      background:
        linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.45)),
        {'url(' + bg_data_uri + ') no-repeat center center' if bg_data_uri else 'none'};
      background-size: 70vh;
    }}
    .wrap{{ max-width:780px; margin:48px auto 96px; padding:0 18px; }}
    h1{{ font-size:28px; margin:0 0 6px; letter-spacing:.2px; text-align:center; font-weight:700; text-shadow:0 2px 10px rgba(0,0,0,.45); }}
    p{{ color:var(--muted); margin:6px 0 12px; }}
    .card{{ background:rgba(12,18,26,.92); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:16px; box-shadow:0 24px 50px rgba(0,0,0,.45); }}
    label{{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }}
    input[type="date"]{{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:rgba(7,11,18,.9); color:var(--text); }}
    .row{{ display:grid; grid-template-columns:repeat(12,1fr); gap:12px; align-items:end; }}
    .kv{{ background:rgba(10,16,24,.75); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px; }}
    .kv h4{{ margin:0 0 6px; font-size:12px; color:var(--muted); font-weight:600; }}
    .kv .val{{ font-size:16px; }}
    .desc-block{{ margin-top:12px; background:rgba(14,22,32,.92); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; box-shadow:0 12px 24px rgba(0,0,0,.35); }}
    .desc-block h3{{ margin:2px 0 2px; font-size:18px; color:#cfe3ff; }}
    .desc-block .tier{{ margin-bottom:6px; font-size:12px; color:#9fc2ff; }}
    .desc-block p{{ margin:8px 0 0; color:#c5d3e3; line-height:1.7; }}
    .small{{ font-size:12px; color:var(--muted); }}
    .note{{ margin:24px 0 8px; font-size:18px; letter-spacing:.2px; }}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tibetan Astrology</h1>

    <div class="card">
      <div class="row">
        <div style="grid-column: span 6;">
          <label for="datePick">Western date</label>
          <input id="datePick" type="date" min="2025-01-01" max="2025-12-31" />
        </div>
        <div style="grid-column: span 6;">
          <div class="small" id="status"></div>
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="kv" style="grid-column: span 3;">
          <h4>Day of week</h4>
          <div class="val" id="fileDOW">–</div>
        </div>
        <div class="kv" style="grid-column: span 3;">
          <h4>Constellation</h4>
          <div class="val" id="fileConst">–</div>
        </div>
        <div class="kv" style="grid-column: span 3;">
          <h4>Pair</h4>
          <div class="val" id="filePair">–</div>
        </div>
        <div class="kv" style="grid-column: span 3;">
          <h4>Minor Combination</h4>
          <div class="val" id="fileResult">–</div>
        </div>
      </div>

      <div class="desc-block" id="descBlock" style="display:none;">
        <h3 id="descTitle">—</h3>
        <div class="tier" id="descTier">—</div>
        <p id="descText">—</p>
      </div>
    </div>

    <h2 class="note">ELEMENTAL CALCULATIONS IN TIBETAN ASTROLOGY</h2>
    <div class="desc-block" id="infoPanel">
      <p>The calculations used on this page are based on the relationship between the element of the planet of the day and the element of constellation on that particular day. It is the most basic calculation but also the one which has the most significant influence on our daily life.</p>
      <blockquote style="margin:10px 0; padding-left:12px; border-left:3px solid #335476; color:#b8c8da;">
        “The daily element combination is known as the ‘Little Combination,’ but it is nevertheless a determining factor in the favorable or unfavorable character of the day. In the order of importance, this combination is the strongest.”<br/>
        <span style="font-size:12px; color:#8aa3bd;">— Cornu Philippe, <em>Tibetan Astrology</em></span>
      </blockquote>
      <blockquote style="margin:10px 0 0; padding-left:12px; border-left:3px solid #335476; color:#b8c8da;">
        “In order to carry out a first and more general consultation of the calendar, one of the most important aspects is the combination of the element of the day of the week with that of the corresponding constellation. This type of consultation is called trodchung or Minor Combination. This does not mean that it is less important, because to arrive at an astrological evaluation of the day this combination is considered the most significant.”<br/>
        <span style="font-size:12px; color:#8aa3bd;">— Namkhai Norbu Rinpoche, <em>Key for Consulting the Tibetan Calendar</em></span>
      </blockquote>

      <div style="margin-top:12px; padding-top:8px; border-top:1px solid rgba(255,255,255,.1)">
        <p><strong>Three excellent combinations:</strong><br/>EARTH-EARTH<br/>WATER-WATER<br/>WATER-EARTH</p>
        <p><strong>Three positive combinations:</strong><br/>FIRE-FIRE<br/>AIR-AIR<br/>FIRE-AIR</p>
        <p><strong>Three negative combinations:</strong><br/>AIR-EARTH<br/>AIR-WATER<br/>FIRE-EARTH</p>
        <p><strong>One fatal combination:</strong><br/>FIRE-WATER</p>
        <p>Relate to this indications/ horoscope as to secondary conditions which can support or obstruct whatever we are doing.</p>
        <p>There are 3 combinations which are excellent, 3 which are positive, 3 unfavourable combinations and 1 fatal combination.</p>
      </div>
    </div>
  </div>

  <script>
    // --- Data (trimmed sample; your full 2025 mapping should be here) ---
    const recordsByDate = {{"28 Feb 2025":{{"lunar":1,"dow":"Fri","constel":"mon gre","pair":"Earth-Water","wdate":"28 Feb 2025"}}}};

    // Combination meanings
    const combos = {{
      "Earth+Earth": {{"tier":"Excellent","name":"Attainment","desc":"Everything is stable and well-supported. Efforts tend to bear fruit, and projects move toward completion without obstacles. It is a day when persistence pays off, making it excellent for important agreements, starting long-term ventures, or solidifying relationships."}},
      "Water+Water": {{"tier":"Excellent","name":"Nectar","desc":"A nourishing and life-supporting combination, like a steady stream feeding fertile fields. It promotes vitality, health, and emotional harmony. Ideal for practices that increase longevity, for developing personal capacity (Wang), and for healing relationships."}},
      "Earth+Water": {{"tier":"Excellent","name":"Youth","desc":"The union of stability (Earth) and nourishment (Water) produces joy and a fresh, optimistic outlook. It encourages emotional renewal, reconciliation, and beginning new ventures with enthusiasm. Happiness, friendship, and trust grow easily under this influence."}},
      "Fire+Fire": {{"tier":"Transformable","name":"Progress","desc":"A strong, driving energy that favors advancement, recognition, and achievement. Great for making bold moves in career or finances. Because it can be intense, success comes if the fire is directed wisely rather than scattered."}},
      "Air+Air":  {{"tier":"Transformable","name":"Perfecting","desc":"The light, mobile nature of Air doubles here, favoring refinement, learning, and completing unfinished work. Desires can be fulfilled if one remains focused. Good for resolving details, improving skills, or polishing presentations."}},
      "Fire+Air": {{"tier":"Transformable","name":"Energy/Force","desc":"Dynamic and stimulating, this pairing fuels ambition and decisive action. It supports leadership, innovation, and undertakings that require courage and quick thinking. If unbalanced, it can lead to impulsive moves—clear intent is essential."}},
      "Earth+Air": {{"tier":"Unfavorable","name":"Consummation","desc":"The solidity of Earth and the restlessness of Air are at odds, leading to instability. Gains can be short-lived, and resources may diminish. Not ideal for investments or long-term commitments. Useful for closure, but risky for beginnings."}},
      "Water+Air": {{"tier":"Unfavorable","name":"Separation","desc":"This pairing suggests drift and division. Relationships or agreements may face misunderstandings or partings. Travel plans or negotiations may be disrupted. Better for letting go of what no longer serves than for trying to bind things together."}},
      "Earth+Fire":{{"tier":"Unfavorable","name":"Burning","desc":"Fire scorches Earth here, creating friction and difficulty. Emotions can run high, and disputes may arise. Not favorable for harmony in partnerships or family matters. Physical health may also feel strained under this influence."}},
      "Fire+Water":{{"tier":"Unfavorable","name":"Death","desc":"Opposing forces clash and can dissolve projects, relationships, or plans suddenly. Avoid important undertakings. Better to rest, do inner work, or conclude matters that must end."}}
    }};

    // Helpers
    function normToken(t) {{ t = t.trim().toLowerCase(); t = t.replace(/wind/g, "air"); return t.charAt(0).toUpperCase() + t.slice(1); }}
    function normalizePair(p) {{ let s = (p || "").replace(/[–-]/g, "+"); const parts = s.split("+").map(x => normToken(x)); return parts.join("+"); }}
    function reversePair(pair) {{ const parts = pair.split("+"); if (parts.length !== 2) return pair; return parts[1] + "+" + parts[0]; }}
    function lookupCombo(pair) {{ return combos[pair] || combos[reversePair(pair)] || null; }}

    const datePick = document.getElementById("datePick");
    const fileDOW = document.getElementById("fileDOW");
    const fileConst = document.getElementById("fileConst");
    const filePair = document.getElementById("filePair");
    const fileResult = document.getElementById("fileResult");
    const descBlock = document.getElementById("descBlock");
    const descTitle = document.getElementById("descTitle");
    const descTier = document.getElementById("descTier");
    const descText = document.getElementById("descText");
    const statusEl = document.getElementById("status");

    function fmtDate_DMonYYYY_to_ISO(dMonY) {{
      const d = new Date(dMonY);
      const y = d.getFullYear();
      const m = (d.getMonth()+1).toString().padStart(2,'0');
      const day = d.getDate().toString().padStart(2,'0');
      return `${{y}}-${{m}}-${{day}}`;
    }}

    function onPick(isoYMD) {{
      // Build a key like "8 Aug 2025"
      const d = new Date(isoYMD);
      const opts = {{ day: "numeric", month: "short", year: "numeric" }};
      const key = d.toLocaleDateString("en-GB", opts).replace(",", "");
      const rec = recordsByDate[key];
      if (!rec) {{
        fileDOW.textContent = "—";
        fileConst.textContent = "—";
        filePair.textContent = "—";
        fileResult.textContent = "—";
        descBlock.style.display = "none";
        return;
      }}
      fileDOW.textContent = rec.dow;
      fileConst.textContent = rec.constel;
      const pair = normalizePair(rec.pair.replace(/\\bWind\\b/g, "Air"));
      filePair.textContent = pair.replace("+","-");
      const combo = lookupCombo(pair);
      if (combo) {{
        fileResult.textContent = `${{combo.name}} (${{combo.tier}})`;
        descBlock.style.display = "block";
        descTitle.textContent = `Minor Combination — ${{combo.name}}`;
        descTier.textContent = combo.tier;
        descText.textContent = combo.desc;
      }} else {{
        fileResult.textContent = "Unknown pair";
        descBlock.style.display = "none";
      }}
    }}

    // Auto-select today's date if it is in 2025
    (function init() {{
      statusEl.textContent = ""; // hide debug
      const today = new Date();
      if (today.getFullYear() === 2025) {{
        const iso = today.toISOString().slice(0,10);
        datePick.value = iso;
        onPick(iso);
      }}
      datePick.addEventListener("change", (e) => onPick(e.target.value));
    }})();
  </script>
</body>
</html>
"""

out_path = Path("/mnt/data/index_cleaned.html")
out_path.write_text(html, encoding="utf-8")
out_path.as_posix()
